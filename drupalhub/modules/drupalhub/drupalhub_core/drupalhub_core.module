<?php
/**
 * @file
 * Code for the DrupalHub feature.
 */

/**
 * Implements hook_permission().
 */
function drupalhub_core_permissions() {
  return array(
    'manage drupalhub settings' => array(
      'title' => t('Managing DrupalHub'),
      'description' => t('Grant to the user the permission to manage DrupalHub settings.')
    ),
  );
}

/**
 * Return a link for open a modal window.
 *
 * @param $info
 *  Array with information about the link:
 *    - text: The text for the link.
 *    - href: The path for the page.
 *    - class: The class of the link.
 *
 * @return String
 *  An HTML markup for the ctools modal link.
 *
 * @code
 *  drupalhub_core_modal_window(array(
 *    'text' => 'Happy text!',
 *    'href' => 'happy-text',
 *    'class' => 'happy-text',
 *  ));
 *
 * @endcode
 */
function drupalhub_core_modal_window($info) {
  // Include the CTools tools that we need.
  ctools_include('ajax');
  ctools_include('modal');
  ctools_modal_add_js();
  $href = $info['href'] . '/nojs';

  return ctools_modal_text_button($info['text'], $href, '', 'ctools-modal-' . $info['class']);
}

/**
 * Return a markup for a ctools page markup.
 */
function drupalhub_core_modal_page() {
  
}

/**
 * Return a markup for the ctools form modal.
 *
 * @param $title
 *  The title of the form.
 * @param $form_id
 *  The form ID.
 * @param $ajax
 *  Determine if the JS is enabled.
 *
 * @return Array
 *  The form render-able array or print the ajax render.
 *
 * @see http://deeson-online.co.uk/labs/insert-form-pop-modal-ctools-and-drupal-7
 * for reference.
 *
 * @code
 *  return drupalhub_core_modal_form(t('Happy!'), 'happy_modal', TRUE);
 * @endcode
 */
function drupalhub_core_modal_form($title, $form_id, $ajax) {
  if ($ajax) {
    ctools_include('modal');
    ctools_include('ajax');

    $form_state = array(
      'ajax' => TRUE,
      'title' => $title,
    );

    $output = ctools_modal_form_wrapper($form_id, $form_state);

    print ajax_render($output);
    drupal_exit();
  }
  else {
    return drupal_get_form($form_id);
  }
}